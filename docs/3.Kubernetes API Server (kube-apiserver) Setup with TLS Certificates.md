ðŸ”§ Step 1:  Prerequisites \
CA Certificate: ca.crt and ca.key (already generated for etcd)\
Service CIDR: 10.96.0.0/24 (default Kubernetes service range)\
Host IP: 192.168.60.12 (replace with your control plane node IP)
ðŸ”§ Step 2:Certificate Generation for kube-apiserver
```bash
SERVICE_CIDR="10.96.0.0/24"
API_SERVICE=$(echo $SERVICE_CIDR | awk 'BEGIN {FS="."} ; { printf("%s.%s.%s.1", $1, $2, $3) }')
echo "Service CIDR: $SERVICE_CIDR"
echo "API Service IP: $API_SERVICE"  # Should output 10.96.0.1
```
ðŸ”§ Step 3:Generate OpenSSL Configuration
```bash
cat <<EOF >openssl-kubeapi.cnf
[req]
req_extensions = v3_req
distinguished_name = req_distinguished_name

[req_distinguished_name]

[v3_req]
basicConstraints = critical, CA:FALSE
keyUsage = critical, nonRepudiation, digitalSignature, keyEncipherment
extendedKeyUsage = serverAuth
subjectAltName = @alt_names

[alt_names]
DNS.1 = kubernetes
DNS.2 = kubernetes.default
DNS.3 = kubernetes.default.svc
DNS.4 = kubernetes.default.svc.cluster
DNS.5 = kubernetes.default.svc.cluster.local
IP.1 = 192.168.60.12
IP.2 = 127.0.0.1
IP.3 = $API_SERVICE
EOF
```
ðŸ”§ Step 4:Generate Certificates
```bash
# 1. Private Key
openssl genpkey -algorithm RSA -out kube-apiserver.key -pkeyopt rsa_keygen_bits:2048

# 2. CSR
openssl req -new -key kube-apiserver.key \
  -subj "/CN=kube-apiserver/O=Kubernetes" \
  -out kube-apiserver.csr \
  -config openssl-kubeapi.cnf

# 3. Sign Certificate (valid for 10 years)
# 1. Generate Private Key (RSA 2048-bit with stronger permissions)
openssl genpkey -algorithm RSA \
  -out kube-apiserver.key \
  -pkeyopt rsa_keygen_bits:2048
chmod 600 kube-apiserver.key  # Restrict access

# 2. Create CSR with Proper SANs (using pre-defined openssl.cnf)
openssl req -new \
  -key kube-apiserver.key \
  -subj "/CN=kube-apiserver/O=Kubernetes" \
  -out kube-apiserver.csr \
  -config openssl.cnf

# 3. Sign Certificate with CA (10-year validity)
openssl x509 -req \
  -in kube-apiserver.csr \
  -CA ca.crt \
  -CAkey ca.key \
  -CAcreateserial \
  -out kube-apiserver.crt \
  -extensions v3_req \
  -extfile openssl.cnf \
  -days 3650  # 10 years

# 4. Verify Certificate
openssl verify -CAfile ca.crt kube-apiserver.crt

# 5. Inspect Certificate Details (Optional)
#openssl x509 -in kube-apiserver.crt -text -noout | grep -A1 "Subject Alternative Name"
```
